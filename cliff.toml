# https://git-cliff.org/docs/configuration

[changelog]
header = "# Changelog\n\n"
# https://tera.netlify.app/docs
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}]\
	(https://github.com/matatk/nu-tracker/releases/tag/{{ version }}) \
	- {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## Unreleased
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags }}
    {% for commit in commits %}
        - {% if commit.breaking %}[**BREAKING:**] {% endif %}\
		  {% if commit.scope %}**{{ commit.scope}}:** {% endif %}\
		  {{ commit.message | upper_first }} \
		  ([{{ commit.id | truncate(length=7, end="") }}](https://github.com/matatk/nu-tracker/commit/{{ commit.id }}))\
    {% endfor %}
{% endfor %}\n
"""
footer = """
<!-- generated by git-cliff -->
"""
# remove the leading and trailing whitespace from the template
trim = true

[git]
# regex for preprocessing the commit messages
commit_preprocessors = [
  { pattern = '\((\w+\s)?#([0-9]+)\)', replace = "([#${2}](https://github.com/matatk/nu-tracker/issues/${2}))"}, # PRs will happen to redirect
]
# regex for parsing and grouping commits
# NOTE: Looks like security/breaking groups can't be guaranteed: https://github.com/orhun/git-cliff/issues/117
commit_parsers = [
  { body = ".*security", group = "<!-- 00 -->Security" },
  { body = ".*BREAKING CHANGE:", group = "<!-- 01 -->Breaking changes" },
  { message = "^feat", group = "<!-- 02 -->Features" },
  { message = "^fix", group = "<!-- 03 -->Bug fixes" },
  { message = "^docs", group = "<!-- 04 -->Documentation" },
  { message = "^perf", group = "<!-- 05 -->Performance" },
  { message = "^refactor", group = "<!-- 06 -->Refactor" },
  { message = "^style", group = "<!-- 07 -->Code style" },
  { message = "^test", group = "<!-- 08 -->Testing" },
  { message = "^build", group = "<!-- 09 -->Builds" },
  { message = "^ci", group = "<!-- 10 -->Continuous integrations" },
  { message = "^chore\\(release\\): ", skip = true },
  { message = "^chore", group = "<!-- 11 -->Chores" },
  { message = "^revert", group = "<!-- 12 -->Reverts" },
]
